(()=>{"use strict";class t{static PAYMENT_SYSTEMS={visa:{pattern:/^4/,lengths:[13,16,19]},mastercard:{pattern:/^(5[1-5]|2(22[1-9]|2[3-9][0-9]|[3-6][0-9]{2}|7[0-1][0-9]|720))/,lengths:[16]},mir:{pattern:/^220[0-4]/,lengths:[16]},amex:{pattern:/^3[47]/,lengths:[15]},discover:{pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5])|64[4-9]|65)/,lengths:[16,19]},jcb:{pattern:/^35(2[89]|[3-8][0-9])/,lengths:[16,19]}};getCardType(e){const s=e.replace(/\D/g,"");for(const[e,i]of Object.entries(t.PAYMENT_SYSTEMS))if(i.pattern.test(s))return e;return null}isValidLuhn(t){const e=t.replace(/\D/g,"").split("").map(Number);if(e.length<13)return!1;let s=0,i=!1;for(let t=e.length-1;t>=0;t--){let n=e[t];i&&(n*=2,n>9&&(n-=9)),s+=n,i=!i}return s%10==0}validate(e){const s=e.replace(/\D/g,""),i=this.getCardType(s);if(!i)return{valid:!1,error:"Неизвестная платежная система"};return t.PAYMENT_SYSTEMS[i].lengths.includes(s.length)?this.isValidLuhn(s)?{valid:!0,type:i}:{valid:!1,error:"Неверный номер карты"}:{valid:!1,error:"Некорректная длина номера"}}}class e{constructor(t){this.validator=t,this.form=document.getElementById("cardForm"),this.input=document.getElementById("cardNumber"),this.icons=document.querySelectorAll(".icon"),this.result=document.getElementById("result")}initialize(){this.setupEventListeners()}setupEventListeners(){this.input.addEventListener("input",(t=>this.handleInput(t))),this.form.addEventListener("submit",(t=>this.handleSubmit(t)))}handleInput(t){this.result.classList.add("hidden");const e=t.target.value.replace(/\D/g,""),s=e.replace(/(\d{4})(?=\d)/g,"$1 ");t.target.value=s.trim();const i=this.validator.getCardType(e);this.updateIcons(i)}updateIcons(t){this.icons.forEach((e=>{e.classList.toggle("active",e.dataset.type===t)}))}handleSubmit(t){t.preventDefault();const e=this.validator.validate(this.input.value);this.result.classList.remove("hidden","valid","invalid"),e.valid?(this.result.textContent=`Карта ${e.type.toUpperCase()}`,this.result.classList.add("valid")):(this.result.textContent=`Ошибка: ${e.error}`,this.result.classList.add("invalid"))}}document.addEventListener("DOMContentLoaded",(()=>{const s=new t;new e(s).initialize()}))})();